<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TurretFall</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="tutorial.css">
  <!-- <link rel="function" href="/.netlify/functions/leaderboard" /> -->
</head>
<body>
  <div id="wrapper">
    <header id="header">
      Turrets vs. Robots!
    </header>
    <img id="turret" src="images/turret.png" alt="Turret">
    <h4 id="message">This tower defense game is designed to push your strategic skills to the limit. It's OK to lose some health at the start, you'll get them back eventually!</h4>

    <div id="popup" class="popup">      <div class="popup-header">
        <button class="tab-button active" onclick="showTab('tutorial')">Tutorial</button>
        <button class="tab-button" onclick="showTab('stats')">Turrets</button>
        <button class="tab-button" onclick="showTab('powerups')">Power-ups</button>
        <button class="tab-button" onclick="showTab('enemies')">Enemies</button>
        <button class="tab-button" onclick="showTab('tips')">Tips</button>
        <button class="close-popup" onclick="closePopup()">×</button>
      </div>
      <div class="popup-content">        <div id="tutorial" class="tab-content active">
          <h1>🎮 Game Tutorial</h1>
          <h3>🏗️ Place Turrets:</h3>
          <ul>
            <li>Click <strong>"Buy Turret"</strong> to purchase a turret (requires money).</li>
            <li>Place the turret on valid spots in the game area (strategic placement is key).</li>
            <li>Drag to the garbage bin to cancel turret selection.</li>
          </ul>
          <h3>⬆️ Upgrade Turrets:</h3>
          <ul>
            <li>Click on a placed turret to select it and view its stats.</li>
            <li>Click <strong>"Upgrade"</strong> to enhance its damage, range, and speed.</li>
            <li>Higher level turrets gain special abilities (check <strong>"Turrets"</strong> tab).</li>
            <li>Strategic upgrading is more effective than placing many weak turrets.</li>
          </ul>
          <h3>🎮 Game Controls:</h3>
          <ul>
            <li><strong>Start Wave:</strong> Initiates the next wave of enemies (can be toggled to auto-start).</li>
            <li><strong>Toggle Speed:</strong> Switches between normal (1x) and fast (2x) game speed.</li>
            <li><strong>Change Target Mode:</strong> Cycles through turret targeting priorities (First, Last, Closest, Strongest).</li>
            <li><strong>Pause/Resume:</strong> Use spacebar or click the pause button to pause the game.</li>
          </ul>
          <h3>💡 Essential Tips:</h3>
          <ul>
            <li>Early game: Focus on 2-3 well-placed, upgraded turrets rather than many weak ones.</li>
            <li>Different turrets excel against different enemy types - diversify your defense!</li>
            <li>Watch your health carefully - it's better to slow down and build strong defenses.</li>
            <li>Power-ups can turn the tide in difficult situations - use them wisely!</li>
            <li>Don't be afraid to sell and reposition turrets as waves get tougher.</li>
          </ul>
        </div><div id="stats" class="tab-content">
          <h1>🚁 Turret Arsenal</h1>
          <div id="stats-sections">
            <!-- Turret stats tables will be populated here by tutorial.js -->
            <p>Loading turret statistics...</p>
          </div>
        </div>
        <div id="powerups" class="tab-content">
          <h1>⚡ Power-ups</h1>
          <div id="powerups-container">
            <!-- Power-up information will be populated here by tutorial.js -->
            <p>Loading power-up information...</p>
          </div>
        </div>        <div id="enemies" class="tab-content">
          <h1>🤖 Enemy Intel</h1>
          <div id="enemies-container">
            <!-- Enemy information table will be populated here by tutorial.js -->
            <p>Loading enemy information...</p>
          </div>
        </div>
        <div id="tips" class="tab-content">
          <h1>🎯 Advanced Tips & Strategies</h1>
          <!-- Content for Tips tab -->
          <h2>General Strategy</h2>
          <ul>
            <li><strong>Economy Management:</strong> Always try to have enough money for crucial upgrades before a tough wave. Don't overspend on new turrets if upgrades are more cost-effective.</li>
            <li><strong>Pathing Exploitation:</strong> Understand how enemies move. Place turrets at chokepoints or along long stretches where they can maximize their firing time.</li>
            <li><strong>Synergy:</strong> Combine turret abilities. For example, use Froster turrets to slow enemies, making them easier targets for Snipers or area-of-effect Wizards.</li>
            <li><strong>Wave Knowledge:</strong> Pay attention to the wave counter and the types of enemies that appear. Prepare for special waves like boss waves or waves with many fast/stealthy enemies.</li>
          </ul>
          <h2>Turret Specific Tips</h2>
          <ul>
            <li><strong>Shooter:</strong> Reliable early-game turret. Good for general purpose defense. Upgrade them steadily.</li>
            <li><strong>Sniper:</strong> Essential for high-health targets like bosses and minibosses. Their long range allows them to cover large parts of the map. Level 3+ Snipers can target invisible units.</li>
            <li><strong>Wizard:</strong> Excellent for crowd control due to piercing projectiles. Effective against groups of weaker enemies. Level 3+ Wizards are immune to stun from Bomb enemies.</li>
            <li><strong>Froster:</strong> Provides crucial slowing effects, which can be upgraded to a full freeze. Very useful for controlling the flow of enemies and clumping them up for other turrets.</li>
          </ul>
          <h2>Enemy Prioritization</h2>
          <ul>
            <li><strong>Healers:</strong> Eliminate these quickly as they can significantly prolong the survival of other enemies.</li>
            <li><strong>Bomb Carriers:</strong> Be mindful of their explosion radius. Try to take them out before they reach dense groups of your turrets, or use stun-immune turrets nearby.</li>
            <li><strong>Stealth Units:</strong> Require specific counter-measures like high-level Snipers or careful placement of other turrets to hit them when they decloak.</li>
          </ul>
          <h2>Advanced Techniques</h2>
          <ul>
            <li><strong>Turret Juggling/Selling:</strong> In desperate situations, selling a less critical turret to afford an upgrade for a more critical one can save you.</li>
            <li><strong>Pre-Wave Building:</strong> Use the time between waves effectively to plan and build/upgrade your defenses.</li>
            <li>Focus on upgrades rather than adding more turrets. Upgrading is often the better choice when it costs less.</li>
            <li>Selling a turret gives back <strong>90%</strong> of all money spent on the turret and reverts the buying cost to the previous one.</li>
            <li>Use a mix of turrets to cover weaknesses:
              <ul>
                <li>Shooter turrets: All-rounders but don't excel in any area.</li>
                <li>Snipers: Great for single-target damage and boss waves due to their range and power.</li>
                <li>Wizards: Reduce health of multiple enemies at once but are less effective against bosses.</li>
              </ul>
            </li>
          </ul>
          
        </div>
        
      </div>
    </div>
    
    
    <button id="openTutorialButton" onclick="toggleTutorialPopup()">
      <span id="tutorial-icon" class="icon-only">📖</span>
    </button>
    
    <div id="container">
      <div id="gameCanvas">
      </div>
      <div id="difficultyScreen" class="difficulty-screen">
          <h1 class="title">SELECT DIFFICULTY</h1>
          <div class="button-container">
              <div class="tooltip-container">
                  <button id="easyButton" class="difficulty-btn easy">EASY</button>
                  <div class="tooltip easy-tooltip">
                      <h3>Easy Mode</h3>
                      <p>Perfect for newcomers to tower defense games</p>
                      <ul>
                          <li>💰 200 gold per wave</li>
                          <li>🤕 Enemies have 20% less health and are 15% slower</li>
                          <li>🪙 40% more gold per damage</li>
                          <li>❤️ Start with 200 health</li>
                          <li>💣 1 bomb enemy on bomb waves</li>
                      </ul>
                  </div>
              </div>
              <div class="tooltip-container">
                  <button id="normalButton" class="difficulty-btn normal">NORMAL</button>
                  <div class="tooltip normal-tooltip">
                      <h3>Normal Mode</h3>
                      <p>The classic tower defense experience</p>
                      <ul>
                          <li>💰 150 gold per wave</li>
                          <li>😐 Standard enemy health</li>
                          <li>❤️ Start with 100 health</li>
                          <li>💣 2 bomb enemy on bomb waves</li>
                      </ul>
                  </div>
              </div>
              <div class="tooltip-container">
                  <button id="hardButton" class="difficulty-btn hard">HARD</button>
                  <div class="tooltip hard-tooltip">
                      <h3>Hard Mode</h3>
                      <p>For experienced players seeking a challenge</p>
                      <ul>
                          <li>💰 135 gold per wave</li>
                          <li>💪 Enemies have 15% more health and are 10% faster</li>
                          <li>🪙 20% less gold per damage</li>
                          <li>❤️ Start with 75 health</li>
                          <li>💔 Health gain per wave halved</li>
                          <li>💣 3 bomb enemy on bomb waves</li>
                      </ul>
                  </div>
              </div>   
          </div>
          <div class="help-text">Hover on a difficulty for more information</div>
      </div>
      <img id="garbage" src="images/garbage.png" alt="Garbage Can">
      
          <div id="turretInfo" class="turret-info">
            <button id="sellButton">Sell</button>
            <h3 id="turretDetailsHeader">Turret Details</h3>
            <div class="damage-counter">Damage: 0</div>
            
            <div class="info-container">
              <div id="turretCurrentStats">
                Level: 2<br>
                Range: 150<br>
                Damage: 30<br>
                Cooldown: 5s
              </div>
              
              <div id="turretNextStats">
                Next Level:<br>
                Range: 180<br>
                Damage: 35<br>
                Cooldown: 4s
              </div>

              <div class="upgrade-section">
                <button id="upgradeButton" class="blue">Upgrade</button>
              </div>
            </div>
          </div>

      <div id="gameMenu">
        <div id="menuInfo">
          <div title="Money" class="menu-stat">
            <img src="images/money.png" alt="Money Icon">
            <h2 id="Money">100</h2>
          </div>
          <div title="Health" class="menu-stat">
            <img src="images/health.png" alt="Health Icon">
            <h2 id="Health">100</h2>
          </div>
          <div title="Wave" class="menu-stat">
            <img src="images/wave.png" alt="Wave Icon">
            <h2 id="Wave">0</h2>
          </div>
        </div>
        <div id="menuButtons">
            <button class="hoverButton" id="buyText" onclick="handleBuyTurretClick()"> <!-- MODIFIED onclick handler -->
          </button>

          <div id="turretMenu" style="display: none;"> 
          </div>

          <button class="hoverButton" id="powerUpText" onclick="handleBuyPowerUpClick()">
            Power-Up Store <img src="images/abilities/speedboost.png" alt="Power-Up Store" style="width: 20px; height: 20px; vertical-align: middle;">
          </button>

          <div id="powerUpMenu" style="display: none;">
          </div>
          
          <button id="startWaveButton" class="hoverButton" onclick="toggleAutoStart()" onmouseover="checkWave()">
            Start Wave 
            <span class="autoStartToggle">Auto Start Toggle: False</span>
            <span class="hoverText" id="waveText">Wave Ready</span>
          </button>

          <button class="hoverButton" onclick="toggleSpeed()" onmouseover="checkSpeed()">
            Toggle Speed
            <span class="hoverText" id="speedText">Current Speed: 1x</span>
          </button>
          <button class="hoverButton" onclick="changeTargetMode()" onmouseover="checkTargetMode()">
            Change Target Mode
            <span class="hoverText" id="targetModeText">Mode: 0 (Closest)</span>
          </button>
        </div>
        <div id="healthPopup" class="popupMessage">+ x Health</div>
        <div id="moneypopup" class="popupMessage">+ x $</div>
        <div id="bossWarningPopup" class="popupMessage">Boss Wave Incoming!</div>
        <div id="minionWarningPopup" class="popupMessage">Boss Spawning Minions!</div>
      </div> 
    <br>
      <!-- Cancel Selection Overlay -->
    <div id="cancelSelectionOverlay" style="display: none;">
      <div class="overlay-content">Click here to cancel turret selection</div>
    </div>
  </div>

  <!-- <div id="leaderboardPrompt" class="popupMessage">
      <div class="prompt-content">
        <span class="trophy-icon">🏆</span>
        <p>Congratulations! You've reached wave 25!</p>
        <p>Add your name to the leaderboard?</p>
      </div>
  </div>
  
  <button id="openLeaderboardBtn">
      <span class="icon-only">🏆</span>
  </button>
  
  <div id="leaderboardPopup" class="popup">
      <div class="popup-header">
        <h2><span class="trophy-icon">🏆</span> Leaderboard</h2>
        <button id="closeLeaderboardBtn" class="close-popup">&times;</button>
      </div>
      
      <div class="popup-content">
        <div class="leaderboard-controls">
          <button id="addEntryButton" class="primary-button">
            <span class="plus-icon">+</span> Add Your Score
          </button>
          <div class="leaderboard-filters">
            <select id="difficultyFilter">
              <option value="all">All Difficulties</option>
              <option value="easy">Easy</option>
              <option value="normal">Normal</option>
              <option value="hard">Hard</option>
            </select>
          </div>
        </div>
    
        <div id="leaderboardContents">
          <div class="leaderboard-loading">Loading entries...</div>
        </div>
      </div>
  </div> -->

  <footer id="footer">
    A project by <a href="https://github.com/changkevin51" target="_blank" style="color: #ffffff; text-decoration: underline;">Kevin Chang</a>
  </footer>
  <script src="https://unpkg.com/@supabase/postgrest-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
  <script src="path.js"></script>
  <script src="enemy.js"></script>
  <script src="turret.js"></script>
  <script src="projectile.js"></script>
  <script src="wave.js"></script>
  <script src="index.js" defer></script>
  <script src="ui.js" defer></script>
  <script src="tutorial.js" defer></script>
  
</body>
</html>
